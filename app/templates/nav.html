
		<h1><a href='/'><img src='{{ url_for('static', filename='img/glimpser_small.png') }}' title='Glimpser'></a></h1>
        <nav>
            <div class="nav-left">
                {% for ag in active_groups %} 
                <a href='/group/{{ag}}'>{{ag}}</a>
                {% endfor %}
            </div>

	    <div class="nav-center" style='text-align:center;'>
{% if template_name %}
<center><h1><a href='/templates/{{template_name}}'>{{template_name}}</a></h1></center>
    {% endif %} 
	    </div>

            <div class="nav-right">
		    <table>
			    <tr>

				    <td>
				    <div id="health-status" style="width: 15px; height: 15px; border-radius: 50%; background-color: grey;"></div>
				    </td>
				    <td>
				    <div id="performance-indicator" class="performance-indicator" title="System Performance">
				        <span id="cpu-usage">CPU: --</span>
				    </div>
				    </td>
	<script>
		function checkHealth() {
    fetch('/health')
        .then(response => {
            if (response.ok) {
                // Server is healthy
                document.getElementById('health-status').style.backgroundColor = 'green';
            } else {
                // Server is down or unhealthy
                document.getElementById('health-status').style.backgroundColor = 'red';
            }
        })
        .catch(error => {
            // Network error or server unreachable
            document.getElementById('health-status').style.backgroundColor = 'red';
        });
}

function updatePerformanceIndicator() {
    fetch('/system_metrics')
        .then(response => response.json())
        .then(data => {
            document.getElementById('cpu-usage').textContent = `CPU: ${data.cpu_usage}%`;
            document.getElementById('performance-indicator').title = `CPU: ${data.cpu_usage}%\nMemory: ${data.memory_usage}%\nDisk: ${data.disk_usage}%\nOpen Files: ${data.open_files}`;
        })
        .catch(error => {
            console.error('Error fetching system metrics:', error);
        });
}

// Ping the health check endpoint every 5 seconds
setInterval(checkHealth, 5000);
// Update performance indicator every 5 seconds
setInterval(updatePerformanceIndicator, 5000);

checkHealth();
updatePerformanceIndicator();

	</script>
				    </td>


{% if request.path == url_for('settings') %}
<td>
        <a href="{{ url_for('logout') }}" class="settings-icon btn btn-danger">Logout</a>
</td>
    {% endif %}

				    <td>
					    <a href='/captions' id='captions' class="settings-icon" title='Read and update camera LLMs'>&#9000;</a>
				    </td><td>
                <a href='/live' id='live'>
                    <div id="coolClock" class="cool-clock" title="Live">
                        <div id="dateDisplay" class="clock-face">
                            <div id="digitalTime" class="clock-hands" title="todo $digitalTime">
                                <div class="hand hour-hand"></div>
                                <div class="hand minute-hand"></div>
                                <div class="hand second-hand"></div>
                            </div>
                        </div>
                    </div>
                </a>
				    </td><td>
                <a href='/settings' class="settings-icon" title="Settings" title='Update settings'>&#9881;</a>
				    </td>


			    </tr>
		    </table>
            </div>
        </nav>

<script>
    function updateCoolClock() {
        const now = new Date();
        const secondsDegrees = (now.getSeconds() / 60) * 360 + 0;
        const minutesDegrees = (now.getMinutes() / 60) * 360 + (now.getSeconds() / 60) * 6 + 0;
        const hoursDegrees = (now.getHours() / 12) * 360 + (now.getMinutes() / 60) * 30 + 0;

        document.querySelector('.second-hand').style.transform = `rotate(${secondsDegrees}deg)`;
        document.querySelector('.minute-hand').style.transform = `rotate(${minutesDegrees}deg)`;
        document.querySelector('.hour-hand').style.transform = `rotate(${hoursDegrees}deg)`;

        document.getElementById('digitalTime').title = now.toLocaleTimeString() + '\n' + Intl.DateTimeFormat().resolvedOptions().timeZone + '\n' + now.toDateString() ;
    }

    setInterval(updateCoolClock, 1000);
    updateCoolClock(); // initial call to display the clock immediately
</script>


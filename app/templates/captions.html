
{% include 'header.html' %} 

<body>
    <header>
        {% include 'nav.html' %}
    </header>

    <script>
        function updateTemplate(templateName) {
            var notes = $('#notes-' + templateName).val();
            $.ajax({
                url: '/update_template/' + templateName,
                type: 'POST',
                data: {notes: notes},
                success: function(response) {
                    alert('Template updated successfully!');
                },
                error: function(error) {
                    alert('Error updating template: ' + error.responseText);
                }
            });
        }
    </script>

    <div>
        <label for="group-dropdown" title="Filter templates by group">Filter by Group:</label>
        <select id="group-dropdown" title="Select a group to filter templates">
            <!-- Options will be populated here -->
        </select>

        <label for="search-input" title="Search for cameras or groups">Search:</label>
        <input type="text" id="search-input" placeholder="Search cameras or groups" title="Enter search terms">
    </div>

    <details><summary>Captions</summary>
        <table border="1" style="width: 100%; border-collapse: collapse;">
            <tr>
                <th style="padding: 8px; background-color: #f4f4f4;">Timestamp</th>
                <th style="padding: 8px; background-color: #f4f4f4;">Caption</th>
            </tr>
            {% for caption in lcaptions %}
            {% for lc in caption %}
            {% if caption[lc] != "" %}
            <tr>
                <td>{{ lc }}</td><td>{{ caption[lc] }}</td>
            </tr>
            {% endif %}
            {% endfor %}
            {% endfor %}
        </table>
    </details>

    <h2>Update Camera Notes</h2>
    <div class="template-container">
        {% for template in template_details %}
            <div class="template">
                <table>
                    <tr>
                        <td>
                            <a href='/templates/{{template}}'><img src="/last_screenshot/{{template}}" alt="Thumbnail" width="256"></a>
                        </td>
                        <td>
                            <div class="details">
                                <p><strong>{{ template }}</strong></p>
                                <textarea id="notes-{{ template }}" name="notes">{{ template_details[template]['notes'] }}</textarea>
                                <p>Last Caption: {{ template_details[template]['last_caption'] }} ({{ template_details[template]['last_caption_date'] }})</p>
                                <p>Last Capture: <span class="last-capture" data-time="{{ template_details[template]['last_screenshot_time'] }}">{{ template_details[template]['last_screenshot_time'] }}</span></p>
                                <p>Next Capture: <span class="next-capture" data-time="{{ template_details[template]['next_screenshot_time'] }}">{{ template_details[template]['next_screenshot_time'] }}</span></p>
                                <button type="button" onclick="updateTemplate('{{ template }}')">Update</button>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        {% endfor %}
    </div>

    {% include 'footer.html' %}

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // Update times every minute
        setInterval(updateHumanizedTimes, 60000);
        // Initial update
        updateHumanizedTimes();
    </script>
</body>

</html>



{% include 'header.html' %} 

<body>
    <header>
        {% include 'nav.html' %}

    </header>


    <h1>System Status</h1>

    <div>
        <label for="group-dropdown">Filter by Group:</label>
        <select id="group-dropdown">
            <option value="all">All Groups</option>
        </select>

        <label for="search-input">Search:</label>
        <input type="text" id="search-input" placeholder="Search cameras or groups">
    </div>

    <h2>System Metrics</h2>
    <ul>
        {% for key, value in metrics.items() %}
            <li>{{ key }}: {{ value }}</li>
        {% endfor %}
    </ul>

    <h2>Camera Schedules</h2>
    <table id="camera-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Thumbnail</th>
                <th>Last Video</th>
                <th>Last Screenshot</th>
                <th>Next Screenshot</th>
                <th>Screenshot Count</th>
                <th>Video Count</th>
                <th>Storage Usage</th>
                <th>LLM Responses</th>
                <th>LLM Cost Estimate</th>
            </tr>
        </thead>
        <tbody>
        {% for camera in camera_schedules %}
            <tr class="camera-row" data-groups="{{ camera.groups }}">
                <td><a href="{{ camera.template_url }}">{{ camera.name }}</a></td>
                <td>
                    {% if camera.thumbnail_url %}
                        <img src="{{ camera.thumbnail_url }}" alt="{{ camera.name }} thumbnail" style="width: 100px; height: auto;">
                    {% else %}
                        No thumbnail
                    {% endif %}
                </td>
                <td>
                    {% if camera.last_video_url %}
                        <video width="100" height="auto" controls>
                            <source src="{{ camera.last_video_url }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    {% else %}
                        No video
                    {% endif %}
                </td>
                <td><span class="humanized-time" data-time="{{ camera.last_screenshot }}">{{ camera.last_screenshot }}</span></td>
                <td><span class="humanized-time" data-time="{{ camera.next_screenshot }}">{{ camera.next_screenshot }}</span></td>
                <td>{{ camera.screenshot_count }}</td>
                <td>{{ camera.video_count }}</td>
                <td>{{ camera.storage_usage }}</td>
                <td>{{ camera.llm_response_count }}</td>
                <td>{{ camera.llm_cost_estimate }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <script>
        $(document).ready(function() {
            updateHumanizedTimes();
            setInterval(updateHumanizedTimes, 60000);
            loadGroups();
            setupSearch();
        });
    </script>
</body>
</html>
